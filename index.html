<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vendor Contact Repository</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        h1 {
            color: white;
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.5em;
        }

        .section {
            background: white;
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
        }

        .section h2 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 1.8em;
            border-bottom: 3px solid #667eea;
            padding-bottom: 10px;
        }

        /* Chat Section */
        #chat-section {
            min-height: 300px;
        }

        .chat-messages {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            min-height: 200px;
            max-height: 400px;
            overflow-y: auto;
            margin-bottom: 20px;
        }

        .message {
            margin-bottom: 15px;
            padding: 12px 16px;
            border-radius: 8px;
            max-width: 80%;
        }

        .user-message {
            background: #667eea;
            color: white;
            margin-left: auto;
            text-align: right;
        }

        .bot-message {
            background: white;
            color: #333;
            border: 1px solid #e0e0e0;
        }

        .chat-input-container {
            display: flex;
            gap: 10px;
        }

        #chat-input {
            flex: 1;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        #chat-input:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn {
            padding: 15px 30px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.3s;
        }

        .btn:hover {
            background: #5568d3;
        }

        .btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        /* Database Section */
        .search-box {
            margin-bottom: 20px;
        }

        #database-search {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
        }

        #database-search:focus {
            outline: none;
            border-color: #667eea;
        }

        .database-table {
            width: 100%;
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        thead {
            background: #667eea;
            color: white;
        }

        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e0e0e0;
        }

        th {
            font-weight: 600;
        }

        tbody tr:hover {
            background: #f8f9fa;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }

        /* Form Section */
        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 600;
        }

        input[type="text"],
        input[type="email"],
        input[type="tel"],
        input[type="date"],
        select,
        textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            font-family: inherit;
            transition: border-color 0.3s;
        }

        input:focus,
        select:focus,
        textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        textarea {
            min-height: 100px;
            resize: vertical;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }
        }

        .success-message {
            background: #4caf50;
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
        }

        .error-message {
            background: #f44336;
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üìã Vendor Contact Repository</h1>

        <!-- Chat Section -->
        <div class="section" id="chat-section">
            <h2>üí¨ Ask About Vendors</h2>
            <div class="chat-messages" id="chat-messages">
                <div class="message bot-message">
                    üëã Hello! I'm here to help you find internal or external contacts or programs that can help you in your business. Ask me anything about vendors, problems you are looking to overcome, or internal or external funds that might be of interest to you. For example: "Do we have any warchest funds for takeouts?" or "Show me who we escalated issues to at Dell who help to get around a pricing issue."
                </div>
            </div>
            <div class="chat-input-container">
                <input type="text" id="chat-input" placeholder="Ask about vendors, contacts, or past issues..." />
                <button class="btn" id="send-btn" onclick="sendMessage()">Send</button>
            </div>
        </div>

        <!-- Submission Form -->
        <div class="section" id="form-section">
            <h2>‚ûï Submit New Interaction</h2>
            <div class="success-message" id="success-message">‚úÖ Successfully submitted!</div>
            <div class="error-message" id="error-message">‚ùå Error submitting. Please try again.</div>
            <form id="submission-form">
                <div class="form-group">
                    <label for="vendor-name">Vendor *</label>
                    <input type="text" id="vendor-name" required placeholder="e.g., Dell, HP, ComputaCenter (Internal), CDW..." />
                </div>

                <div class="form-group">
                    <label for="interaction-summary">What was this interaction about? *</label>
                    <textarea id="interaction-summary" required placeholder="Brief summary... (e.g., 'Used a special promotion to close a large laptop deal' or 'Found a workaround for their supply chain issue')"></textarea>
                </div>

                <div class="form-group">
                    <label for="helpful-contacts">Contacts Who Helped You</label>
                    <textarea id="helpful-contacts" placeholder="Paste signature blocks or contact info here. You can include multiple contacts.

Example:
John Smith
Account Manager
john.smith@vendor.com
(555) 123-4567

Jane Doe
Sales Engineer
jane.doe@vendor.com"></textarea>
                </div>

                <div class="form-group">
                    <label for="detailed-notes">Detailed Notes *</label>
                    <textarea id="detailed-notes" required style="min-height: 150px;" placeholder="Tell the full story... What happened? How did you overcome the challenge? What specifically worked? What should others know?"></textarea>
                </div>

                <button type="submit" class="btn">Submit Interaction</button>
            </form>
        </div>

        <!-- Database Section -->
        <div class="section" id="database-section">
            <h2>üìä All Vendor Interactions</h2>
            <div class="search-box">
                <input type="text" id="database-search" placeholder="üîç Filter by vendor, contact, problem type..." onkeyup="filterDatabase()" />
            </div>
            <div class="database-table">
                <table id="data-table">
                    <thead>
                        <tr>
                            <th>Vendor</th>
                            <th>Interaction Summary</th>
                            <th>Key Contacts</th>
                            <th>Detailed Notes</th>
                            <th>Date</th>
                        </tr>
                    </thead>
                    <tbody id="table-body">
                        <tr>
                            <td colspan="5" class="loading">Loading data...</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        // Configuration - Replace these with your n8n webhook URLs
        const CONFIG = {
            chatWebhook: 'https://agelessventures.app.n8n.cloud/webhook/8f26e1fb-cfec-48bb-8324-735aac719f69',
            databaseWebhook: 'https://agelessventures.app.n8n.cloud/webhook/8f26e1fb-cfec-48bb-8324-735aac719f71',
            submitWebhook: 'https://agelessventures.app.n8n.cloud/webhook/8f26e1fb-cfec-48bb-8324-735aac719f70'
        };

        // Chat functionality
        // Generate or retrieve session ID
        function getSessionId() {
            let sessionId = sessionStorage.getItem('chatSessionId');
            if (!sessionId) {
                sessionId = 'session_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
                sessionStorage.setItem('chatSessionId', sessionId);
            }
            return sessionId;
        }

        function sendMessage() {
            const input = document.getElementById('chat-input');
            const message = input.value.trim();
            
            if (!message) return;

            // Add user message to chat
            addMessageToChat(message, 'user');
            input.value = '';

            // Disable button while processing
            const sendBtn = document.getElementById('send-btn');
            sendBtn.disabled = true;
            sendBtn.textContent = 'Thinking...';

            // Send to n8n webhook with session ID
            fetch(CONFIG.chatWebhook, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ 
                    question: message,
                    sessionId: getSessionId()
                })
            })
            .then(response => response.json())
            .then(data => {
                // Add bot response
                addMessageToChat(data.answer || 'Sorry, I couldn\'t process that request.', 'bot');
            })
            .catch(error => {
                addMessageToChat('Sorry, there was an error connecting to the AI. Please check your webhook configuration.', 'bot');
                console.error('Chat error:', error);
            })
            .finally(() => {
                sendBtn.disabled = false;
                sendBtn.textContent = 'Send';
            });
        }

        function addMessageToChat(text, sender) {
            const messagesDiv = document.getElementById('chat-messages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender}-message`;
            messageDiv.textContent = text;
            messagesDiv.appendChild(messageDiv);
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        }

        // Allow Enter key to send message
        document.getElementById('chat-input').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });

        // Load database data
        function loadDatabaseData() {
            fetch(CONFIG.databaseWebhook)
            .then(response => response.json())
            .then(data => {
                displayDatabaseData(data.records || []);
            })
            .catch(error => {
                document.getElementById('table-body').innerHTML = 
                    '<tr><td colspan="5" class="loading">Error loading data. Please check your webhook configuration.</td></tr>';
                console.error('Database load error:', error);
            });
        }

        function displayDatabaseData(records) {
            const tbody = document.getElementById('table-body');
            
            if (records.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" class="loading">No records found. Submit your first interaction below!</td></tr>';
                return;
            }

            tbody.innerHTML = records.map(record => `
                <tr>
                    <td>${record.vendor || 'N/A'}</td>
                    <td>${record.summary || 'N/A'}</td>
                    <td style="white-space: pre-line;">${record.contacts || 'N/A'}</td>
                    <td style="white-space: pre-line;">${record.notes || 'N/A'}</td>
                    <td>${record.date || 'N/A'}</td>
                </tr>
            `).join('');
        }

        // Filter database
        function filterDatabase() {
            const searchTerm = document.getElementById('database-search').value.toLowerCase();
            const rows = document.querySelectorAll('#table-body tr');
            
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(searchTerm) ? '' : 'none';
            });
        }

        // Form submission
        document.getElementById('submission-form').addEventListener('submit', function(e) {
            e.preventDefault();

            // Disable button while submitting
            const submitBtn = document.querySelector('#submission-form .btn');
            submitBtn.disabled = true;
            submitBtn.textContent = 'Submitting...';

            const formData = {
                vendorName: document.getElementById('vendor-name').value,
                interactionSummary: document.getElementById('interaction-summary').value,
                helpfulContacts: document.getElementById('helpful-contacts').value,
                detailedNotes: document.getElementById('detailed-notes').value,
                submittedDate: new Date().toISOString()
            };

            fetch(CONFIG.submitWebhook, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(formData)
            })
            .then(response => {
                if (response.ok) {
                    // Show success message
                    const successMsg = document.getElementById('success-message');
                    successMsg.style.display = 'block';
                    setTimeout(() => successMsg.style.display = 'none', 5000);

                    // Reset form
                    document.getElementById('submission-form').reset();

                    // Reload database
                    loadDatabaseData();
                } else {
                    throw new Error('Submission failed');
                }
            })
            .catch(error => {
                // Show error message
                const errorMsg = document.getElementById('error-message');
                errorMsg.style.display = 'block';
                setTimeout(() => errorMsg.style.display = 'none', 5000);
                console.error('Submission error:', error);
            })
            .finally(() => {
                // Re-enable button
                submitBtn.disabled = false;
                submitBtn.textContent = 'Submit Interaction';
            });
        });

        // Load data on page load
        window.addEventListener('load', function() {
            loadDatabaseData();
        });
    </script>
</body>
</html>
